# frozen_string_literal: true

followup_subform_fields = [
  Field.new('name' => 'followup_service_type',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'select_box',
            'display_name_en' => 'Type of service',
            'option_strings_source' => 'lookup lookup-service-type'),
  Field.new('name' => 'followup_assessment_type',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'select_box',
            'display_name_en' => 'Type of assessment',
            'option_strings_text_en' => [
              { id: 'personal_intervention_assessment', display_text: 'Personal Intervention Assessment' },
              { id: 'medical_intervention_assessment', display_text: 'Medical Intervention Assessment' },
              { id: 'family_intervention_assessment', display_text: 'Family Intervention Assessment' },
              { id: 'community_intervention_assessment', display_text: 'Community Intervention Assessment' },
              { id: 'unhcr_intervention_assessment', display_text: 'UNHCR Intervention Assessment' },
              { id: 'ngo_intervention_assessment', display_text: 'NGO Intervention Assessment' },
              { id: 'economic_intervention_assessment', display_text: 'Economic Intervention Assessment' },
              { id: 'education_intervention_assessment', display_text: 'Education Intervention Assessment' },
              { id: 'health_intervention_assessment', display_text: 'Health Intervention Assessment' },
              { id: 'other_intervention_assessment', display_text: 'Other Intervention Assessment' }
            ].map(&:with_indifferent_access)),
  Field.new('name' => 'protection_concern_type',
            'mobile_visible' => false,
            'type' => 'select_box',
            'visible' => false,
            'display_name_en' => 'Type of Protection Concern ',
            'option_strings_source' => 'lookup lookup-protection-concerns'),
  Field.new('name' => 'followup_needed_by_date',
            'type' => 'date_field',
            'display_name_en' => 'Follow up needed by',
            'help_text_en' => 'This field will create a reminder in the Task list.'),
  Field.new('name' => 'followup_date',
            'type' => 'date_field',
            'display_name_en' => 'Date of follow-up'),
  Field.new('name' => 'followup_type',
            'visible' => true,
            'mobile_visible' => false,
            'type' => 'select_box',
            'display_name_en' => 'Type of follow up',
            'help_text_en' => "If following up on the client's request to review or receive a copy of their data, enter the details of how you shared the data in the 'Outcome of follow up' field below.",
            'guiding_questions_en' => "You can use the PDF export to produce a copy of the client's data for them to review.",
            'option_strings_source' => 'lookup lookup-followup-type'),
  Field.new('name' => 'followup_with',
            'type' => 'select_box',
            'multi_select' => false,
            'display_name_en' => 'Followed up with',
            'visible' => false,
            'option_strings_source' => 'lookup lookup-followedup-with'),
  Field.new('name' => 'followup_with_multi',
            'type' => 'select_box',
            'multi_select' => true,
            'display_name_en' => 'Followed up with',
            'option_strings_source' => 'lookup lookup-followedup-with'),
  Field.new('name' => 'other_please_specify',
            'type' => 'text_field',
            'display_name_en' => 'If other, please specify'),
  Field.new('name' => 'followed_up_through',
            'type' => 'select_box',
            'multi_select' => false,
            'display_name_en' => 'Followed up through',
            'option_strings_text_en' => [
              { id: 'phone_call', display_text: 'Phone call' },
              { id: 'instant_message_sms_whatsapp', display_text: 'Instant message/SMS/WhatsApp' },
              { id: 'email', display_text: 'Email' },
              { id: 'social_media', display_text: 'Social media' },
              { id: 'ad_hoc_home_visit_child_family', display_text: 'Ad-hoc home visit (child/family)' },
              { id: 'scheduled_home_visit_child_family', display_text: 'Scheduled home visit (child/family)' },
              { id: 'face_to_face_meeting_outside_of_home_child_family', display_text: 'Face-to-face meeting outside of home (child/family)' },
              { id: 'face_to_face_meeting_service_provider_and_child_family', display_text: 'Face-to-face meeting (service provider and child/family)' },
              { id: 'face_to_face_meeting_service_provider_only', display_text: 'Face-to-face meeting (service provider only)' },
              { id: 'community_based_group', display_text: 'Community-based group' },
              { id: 'authorities', display_text: 'Authorities' },
              { id: 'other', display_text: 'Other' }
            ].map(&:with_indifferent_access)),
  Field.new('name' => 'followup_other_specify',
            'type' => 'text_field',
            'display_name_en' => 'If other, please specify'),
  Field.new('name' => 'followed_specific_action',
            'type' => 'radio_button',
            'display_name_en' => 'Followed up on specific action/service from case plan?',
            'option_strings_source' => 'lookup lookup-yes-no'),
  Field.new('name' => 'specify_action',
            'type' => 'textarea',
            'display_name_en' => 'Specify which action/service (from case plan) followed up on or what other element followed-up on'),
  Field.new('name' => 'purpose_followup',
            'type' => 'textarea',
            'display_name_en' => 'Purpose of follow up',
            'help_text_en' => 'Describe the reason for following-up on this specific action/service/element'),
  Field.new('name' => 'followup_result_separator',
            'type' => 'separator',
            'display_name_en' => 'Follow up Result'),
  Field.new('name' => 'outcome_followup',
            'type' => 'textarea',
            'display_name_en' => 'Outcome of follow up',
            'help_text_en' => "E.g. details about the action taken/service provided, the outcomes of the action taken/service provided, details about the change in the child's situation"),
  Field.new('name' => 'action_conducted',
            'type' => 'select_box',
            'multi_select' => false,
            'display_name_en' => 'If followed up on, has the specific action/service from the case plan been conducted?',
            'option_strings_text_en' => [
              { id: 'yes', display_text: 'Yes' },
              { id: 'no', display_text: 'No' },
              { id: 'unable_to_determine', display_text: 'Unable to determine' }
            ].map(&:with_indifferent_access)),
  Field.new('name' => 'situation_changed',
            'type' => 'select_box',
            'multi_select' => false,
            'display_name_en' => 'If followed up on, has the situation of the child significantly changed?',
            'option_strings_text_en' => [
              { id: 'yes', display_text: 'Yes' },
              { id: 'improved', display_text: 'Improved' },
              { id: 'declined', display_text: 'Declined' },
              { id: 'no', display_text: 'No' },
              { id: 'unable_to_determine', display_text: 'Unable to determine' }
            ].map(&:with_indifferent_access)),
  Field.new('name' => 'next_steps_separator',
            'type' => 'separator',
            'display_name_en' => 'Next Steps'),
  Field.new('name' => 'need_follow_up_visit',
            'type' => 'radio_button',
            'display_name_en' => 'Is there a need for further Follow up?',
            'option_strings_source' => 'lookup lookup-yes-no',
            'help_text_en' => 'If there is a need for a further follow up, create a new subform entry for that follow up and enter the date the follow is needed by there.'),
  Field.new('name' => 'other_recommend_followup',
            'type' => 'textarea',
            'display_name_en' => 'Are there any other recommendations based on the follow-up conducted?'),
  Field.new('name' => 'child_was_seen',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'radio_button',
            'display_name_en' => 'Was the child/adult seen during the visit?',
            'option_strings_source' => 'lookup lookup-yes-no'),
  Field.new('name' => 'reason_child_not_seen',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'select_box',
            'multi_select' => true,
            'display_name_en' => 'If not, why?',
            'option_strings_text_en' => [
              { id: 'abducted', display_text: 'Abducted' },
              { id: 'at_school', display_text: 'At School' },
              { id: 'child_in_detention', display_text: 'Child in Detention' },
              { id: 'moved_onto_street', display_text: 'Moved onto street/Market' },
              { id: 'moved_to_live_with_another_caregiver', display_text: 'Moved to live with another caregiver' },
              { id: 'visiting_friends_relatives', display_text: 'Visiting Friends/Relatives' },
              { id: 'working', display_text: 'Working /At work' },
              { id: 'other', display_text: 'Other, please specify' }
            ].map(&:with_indifferent_access)),
  Field.new('name' => 'reason_child_not_seen_other_details',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'text_field',
            'display_name_en' => 'If other, please specify'),
  Field.new('name' => 'action_taken_already',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'radio_button',
            'display_name_en' => 'Has action been taken?',
            'option_strings_source' => 'lookup lookup-yes-no'),
  Field.new('name' => 'action_taken_details',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'text_field',
            'display_name_en' => 'Details about action taken'),
  Field.new('name' => 'action_taken_date',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'date_field',
            'display_name_en' => 'Date action taken?'),
  Field.new('name' => 'when_follow_up_visit_should_happen',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'date_field',
            'display_name_en' => 'If yes, when do you recommend the next visit to take place?'),
  Field.new('name' => 'recommend_case_closed',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'radio_button',
            'display_name_en' => 'If not, do you recommend that the case be closed?',
            'option_strings_source' => 'lookup lookup-yes-no'),
  Field.new('name' => 'followup_comments',
            'visible' => false,
            'mobile_visible' => false,
            'type' => 'text_field',
            'display_name_en' => 'Comments')
]

followup_subform_section = FormSection.create_or_update!(
  'visible' => false,
  'is_nested' => true,
  :order_form_group => 95,
  :order => 20,
  :order_subform => 1,
  :unique_id => 'followup_subform_section',
  :parent_form => 'case',
  'editable' => true,
  :fields => followup_subform_fields,
  :initial_subforms => 1,
  :subform_prevent_item_removal => true,
  'name_en' => 'Nested Followup Subform',
  'description_en' => 'Nested Followup Subform',
  'collapsed_field_names' => %w[followup_date followup_type]
)

followup_fields = [
  Field.new('name' => 'followup_subform_section',
            'type' => 'subform', 'editable' => true,
            'subform_section' => followup_subform_section,
            'display_name_en' => 'Follow Up',
            'subform_sort_by' => 'followup_date')
]

FormSection.create_or_update!(
  :unique_id => 'followup',
  :parent_form => 'case',
  'visible' => true,
  :order_form_group => 95,
  :order => 20,
  :order_subform => 0,
  :form_group_id => 'services_follow_up',
  'editable' => true,
  :fields => followup_fields,
  'name_en' => 'Follow Up',
  'description_en' => 'Follow Up'
)
