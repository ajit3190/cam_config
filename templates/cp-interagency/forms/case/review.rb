# frozen_string_literal: true

review_fields_subform = [
  Field.new(name: 'review_form_date',
            type: 'date_field',
            display_name_en: 'Date form completed'),
  Field.new(name: 'review_separator',
            type: 'separator',
            display_name_en: 'Details of review meeting'),
  Field.new(name: 'review_date',
            type: 'date_field',
            display_name_en: 'Date of review meeting'),
  Field.new(name: 'previous_review_date',
            type: 'date_field',
            display_name_en: 'Date of previous review meeting (if relevant)'),
  Field.new(name: 'was_child_present',
            type: 'radio_button',
            display_name_en: 'Was the child present?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'how_child_review',
            type: 'text_field',
            display_name_en: 'If no, how was the child involved in the review?'),
  Field.new(name: 'was_caregiver_present',
            type: 'radio_button',
            display_name_en: 'Was the caregiver present?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'how_caregiver_review',
            type: 'text_field',
            display_name_en: 'If no, how was the caregiver involved in the review?'),
  Field.new(name: 'outcome_review_separator',
            type: 'separator',
            display_name_en: 'Outcomes of review meeting'),
  Field.new(name: 'review_childs_situation',
            type: 'textarea',
            display_name_en: "Review on child's current situation",
            help_text_en: 'Describe the overall current situation of the child as discussed in the review meeting'),
  Field.new(name: 'review_implementation',
            type: 'textarea',
            display_name_en: 'Review on case plan implementation',
            help_text_en: 'Evaluate the status of actions taken and services provided as outlined in the case plan and discussed during the review meeting.'),
  Field.new(name: 'review_progress_goal',
            type: 'textarea',
            display_name_en: 'Review on progress towards the overall goal of the case plan',
            help_text_en: 'Evaluate the progress towards meeting the overall goal of the case plan as discussed during the review meeting.'),
  Field.new(name: 'review_other_notes',
            type: 'textarea',
            display_name_en: 'Other notes / observations during review meeting'),
  Field.new(name: 'next_steps_separator',
            type: 'separator',
            display_name_en: 'Next steps'),
  Field.new(name: 'review_situation_change',
            type: 'radio_button',
            display_name_en: 'Did the situation of the child change in such a way that warrants another assessment to be conducted?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'situation_change_details',
            type: 'textarea',
            display_name_en: 'Please provide details'),
  Field.new(name: 'adjustments_case_plan',
            type: 'radio_button',
            display_name_en: 'Are any adjustments needed in the case plan?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'adjustment_details',
            type: 'textarea',
            display_name_en: 'Please provide details'),
  Field.new(name: 'risk_level_changed',
            type: 'radio_button',
            display_name_en: 'Has the risk level of the case changed?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'action_conducted',
            type: 'select_box',
            display_name_en: 'If yes, new risk level',
            option_strings_text_en: [
              { id: 'high', display_text: 'High' },
              { id: 'medium', display_text: 'Medium' },
              { id: 'low', display_text: 'Low' },
              { id: 'no', display_text: 'No' }
            ].map(&:with_indifferent_access)),
  Field.new(name: 'risk_level_details',
            type: 'textarea',
            display_name_en: 'If yes, please provide details'),
  Field.new(name: 'recommend_close_case',
            type: 'radio_button',
            display_name_en: 'Do you recommend to close the case?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'close_case_details',
            type: 'textarea',
            display_name_en: 'Please provide details'),
  Field.new(name: 'next_case_review',
            type: 'radio_button',
            display_name_en: 'Is there a need for a next case review?',
            option_strings_source: 'lookup lookup-yes-no'),
  Field.new(name: 'date_next_review',
            type: 'date_field',
            display_name_en: 'If yes, date of next review meeting')
]

review_section = FormSection.create_or_update!(
  'visible' => false,
  'is_nested' => true,
  :mobile_form => true,
  :order_form_group => 50,
  :order => 10,
  :order_subform => 1,
  :unique_id => 'review_section',
  :parent_form => 'case',
  'editable' => true,
  :fields => review_fields_subform,
  :initial_subforms => 1,
  'name_en' => 'Nested Review',
  'description_en' => 'Review Subform',
  'collapsed_field_names' => ['review_form_date']
)

review_fields = [
  Field.new('name' => 'review_section',
            'type' => 'subform',
            'editable' => true,
            'subform_section' => review_section,
            'display_name_en' => 'Case Review')
]

FormSection.create_or_update!(
  :unique_id => 'review',
  :parent_form => 'case',
  'visible' => true,
  :order_form_group => 105,
  :order => 21,
  :order_subform => 0,
  :form_group_id => 'review',
  'editable' => true,
  :fields => review_fields,
  'name_en' => 'Case Review',
  'description_en' => 'Case Review'
)
